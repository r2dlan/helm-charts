# CUPS Helm Chart

A Helm chart for deploying [CUPS (Common UNIX Printing System)](https://www.cups.org/) as a print server in a Kubernetes cluster.

---

## Features

- Deploys a standalone CUPS server
- Exposes the CUPS web interface via Kubernetes Service
- Persistent storage support
- Secret-based authentication with optional auto-generation
- Configurable environment variables
- Automatic Pod restart on Secret changes

---

## Prerequisites

- Kubernetes v1.19+
- Helm v3.0+
- A default StorageClass (if using persistence)

---

## Installation

Add your Helm repository (if published):

```bash
helm repo add r2dlan https://r2dlan.github.io/helm-charts/
helm repo update
```

Install the chart:

```bash
helm install my-cups r2dlan/cups
```

Or from local:

```bash
helm install my-cups ./charts/cups
```

## Uninstall

```bash
helm uninstall my-cups
```

# Configuration

You can override chart settings via --set or values.yaml.

| Key                | Description                             | Default             |
| ------------------ | --------------------------------------- | ------------------- |
| `image.repository` | CUPS Docker image                       | `openprinting/cups` |
| `image.tag`        | Tag/version of the image                | `2.4.6`             |
| `service.type`     | Service type (ClusterIP, NodePort, etc) | `ClusterIP`         |
| `service.port`     | Service port                            | `631`               |
| `auth.username`    | Optional username for CUPS UI           | autogenerated       |
| `auth.password`    | Optional password for CUPS UI           | autogenerated       |
| `extraEnv`         | Additional environment variables        | `{}`                |

# Persistence

| Key                            | Description                      | Default           |
| ------------------------------ | -------------------------------- | ----------------- |
| `persistence.enabled`          | Enable persistent storage        | `false`           |
| `persistence.size`             | Volume size                      | `200Mi`           |
| `persistence.accessMode`       | Access mode (e.g. ReadWriteOnce) | `ReadWriteOnce`   |
| `persistence.storageClassName` | StorageClass to use              | (unset = default) |

# Environment Variables

```bash
extraEnv:
  TZ: Europe/Berlin
  CUSTOM_VAR: value123
```

# Secrets & Authentication

If no username/password is provided in values.yaml, random values will be generated and injected via Kubernetes Secret.

Secrets are automatically checksum-hashed into the Deployment to ensure pods are restarted on changes.

# Accessing the CUPS Interface

After deployment:

```bash
kubectl port-forward svc/my-cups 631:631
```

# License

This chart is licensed under the Apache 2.0 License.

# Maintainers

- Daniel Andres (moin@daniel-andres.com)
